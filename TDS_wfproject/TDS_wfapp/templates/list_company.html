{% load static %}
<!DOCTYPE html>
<html lang="en" dir="ltr" data-nav-layout="vertical" data-theme-mode="light" data-header-styles="light"
    data-menu-styles="dark" data-toggled="close">


<head><!-- Meta Data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Workforce - Company</title>

    <!-- Favicon -->

    <script src="{% static 'js/main.js' %}"></script> <!-- Bootstrap Css -->
    <link id="style" href="{% static 'libs/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet"> <!-- Style Css -->
    <link href="{% static 'css/styles.min.css' %}" rel="stylesheet"> <!-- Icons Css -->
    <link href="{% static 'css/icons.css' %}" rel="stylesheet"> <!-- Node Waves Css -->
    <link href="{% static 'libs/node-waves/waves.min.css' %}" rel="stylesheet"> <!-- Simplebar Css -->
    <link href="{% static 'libs/simplebar/simplebar.min.css' %}" rel="stylesheet"> <!-- Color Picker Css -->
    <link rel="stylesheet" href="{% static 'libs/flatpickr/flatpickr.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/icons.css' %}">
    <link rel="stylesheet" href="{% static 'icon-fonts/boxicons/css/boxicons.css' %}">
    <link rel="stylesheet" href="{% static 'icon-fonts/boxicons/css/styles.min.css' %}">
    <link rel="stylesheet" href="{% static 'libs/%40simonwep/pickr/themes/nano.min.css' %}"> <!-- Choices Css -->
</head>

<body>

    <!-- Modal for delete confirmation -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this company?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
                </div>
            </div>
        </div>
    </div>
    <!--      Modal Delete End        -->

    <div class="page"> <!-- app-header -->
        <header class="app-header"> <!-- Start::main-header-container -->
            <div class="main-header-container container-fluid"> <!-- Start::header-content-left -->
                <div class="header-content-left"> <!-- Start::header-element -->
                    <div class="header-element">
                        <div class="horizontal-logo"> <a href="index.html" class="header-logo"> <img
                                    src="{% static 'images/Workforce_logo_white.png' %}" alt="logo" class="toggle-dark"> </a>
                        </div>
                    </div> <!-- End::header-element -->
                </div> <!-- End::main-header-container -->
                <!-- Start:Profile at Topbar -->

                <div class="header-element"> <!-- Start::header-link|dropdown-toggle --> <a href="javascript:void(0);"
                        class="header-link dropdown-toggle" id="mainHeaderProfile" data-bs-toggle="dropdown"
                        data-bs-auto-close="outside" aria-expanded="false">
                        <div class="d-flex align-items-center">
                            <div class="me-sm-2 me-0"> <img src="{% static 'images/Workforce_logo_white.png' %}" alt="img"
                                    width="32" height="32" class="rounded-circle"> </div>
                            <div class="d-sm-block d-none">
                                <p class="fw-semibold mb-0 lh-1">Info</p><span class="op-7 fw-normal d-block fs-11">Role
                                    - Admin</span>
                            </div>
                        </div>
                    </a> <!-- End::header-link|dropdown-toggle -->
                    <ul class="main-header-dropdown dropdown-menu pt-0 overflow-hidden header-profile-dropdown dropdown-menu-end"
                        aria-labelledby="mainHeaderProfile">
                        <li><a class="dropdown-item d-flex" href="profile.html"><i
                                    class="ti ti-user-circle fs-18 me-2 op-7"></i>Profile</a></li>
                        <li><a class="dropdown-item d-flex" href="sign-in-cover.html"><i
                                    class="ti ti-logout fs-18 me-2 op-7"></i>Log Out</a></li>
                    </ul>
                </div>

                <!-- End: -->
        </header><!-- Start::app-sidebar -->

        <aside class="app-sidebar sticky" id="sidebar"> <!-- Start::main-sidebar-header -->
            <div class="main-sidebar-header"> <a href="index.html" class="header-logo"><img
                        src="{% static 'images/Workforce_logo_white.png' %}" alt="logo" class="desktop-dark"> </a>
            </div>
            <!-- End::main-sidebar-header --> <!-- Start::main-sidebar -->
            <div class="main-sidebar" id="sidebar-scroll" data-simplebar="init">
                <div class="simplebar-wrapper" style="margin: -8px 0px -80px;">
                    <div class="simplebar-height-auto-observer-wrapper">
                        <div class="simplebar-height-auto-observer"></div>
                    </div>
                    <div class="simplebar-mask">
                        <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                            <div class="simplebar-content-wrapper" tabindex="0" role="region"
                                aria-label="scrollable content" style="height: 100%; overflow: hidden scroll;">
                                <div class="simplebar-content" style="padding: 8px 0px 80px;">
                                    <!-- Start::nav -->
                                    <nav class="main-menu-container nav nav-pills flex-column sub-open open active">
                                        <ul class="main-menu"
                                            style="display: block; margin-left: 0px; margin-right: 0px;">
                                            <li class="slide">
                                                <a href="{% url 'dashboard' %}" class="side-menu__item">
                                                    <i class="bi bi-speedometer side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Dashboard</span>
                                                </a>
                                            </li>
                                            <li class="slide">
                                                <a href="{% url 'list_company' %}" class="side-menu__item active">
                                                    <i class="bi bi-briefcase side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Companies</span>
                                                </a>
                                            </li>
                                            <li class="slide">
                                                <a href="{% url 'list_recruiters' %}" class="side-menu__item">
                                                    <i class="bi bi-award side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Recruiters</span>
                                                </a>
                                            </li>
                                            <li class="slide">
                                                <a href="{% url 'list_talent' %}" class="side-menu__item ">
                                                    <i class="bi-people side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Talent</span>
                                                </a>
                                            </li>
                                            <li class="slide">
                                                <a href="{% url 'list_jobs' %}" class="side-menu__item ">
                                                    <i class="bi-joystick side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Jobs</span>
                                                </a>
                                            </li>
                                            <li class="slide">
                                                <a href="{% url 'list_meetings' %}" class="side-menu__item">
                                                    <i class="bi-calendar side-menu__icon"></i>
                                                    <span class="side-menu__label" style="margin-top:7px;">
                                                        Meetings</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </nav> <!-- End::nav -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="simplebar-placeholder" style="width: auto; height: 1200px;"></div>
                </div>
                <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;">
                    <div class="simplebar-scrollbar"
                        style="width: 0px; display: none; transform: translate3d(0px, 0px, 0px);">
                    </div>
                </div>
                <div class="simplebar-track simplebar-vertical" style="visibility: visible;">
                    <div class="simplebar-scrollbar"
                        style="height: 142px; transform: translate3d(0px, 0px, 0px); display: block;"></div>
                </div>
            </div> <!-- End::main-sidebar -->
        </aside> <!-- End::app-sidebar --> <!-- Start::app-content -->
        <div class="main-content app-content">
            <div class="container"> <!-- Page Header -->
                <div class="row mt-4">
                    <div class="col-xl-6">
                        <h1 class="page-title fw-semibold fs-18 mb-0">Companies</h1>
                        <nav>
                            <ol class="breadcrumb breadcrumb-style2 mt-2">
                                <li class="breadcrumb-item"><a href="javascript:void(0);"><i
                                            class="ti ti-home-2 me-1 fs-15 d-inline-block"></i>Home</a></li>
                                <li class="breadcrumb-item"><a href="javascript:void(0);"><i
                                            class="ti ti-briefcase me-1 fs-15 d-inline-block"></i>Companies</a></li>
                                <li class="breadcrumb-item active" aria-current="page">List</li>
                            </ol>
                        </nav>
                    </div>
                    <div class="col-xl-6 justify-content-end text-end">
                        <a href="{% url 'add_company' %}"
                            class="btn btn-outline-primary rounded-pill btn-wave waves-effect waves-light"> + Create
                            Company</a>
                    </div>
                </div>
                <div id="liveAlertPlaceholder" style="display:none">
                    <div class="mb-2"></div>
                    <div class="mb-2"></div>
                    <div class="mb-2"></div>
                    <div class="mb-2"></div>
                    <div>
                        <div class="alert mb-2 alert-success alert-dismissible" role="alert">
                            <div>New Comoany details are created!</div> <button type="button" class="btn-close"
                                data-bs-dismiss="alert" aria-label="Close"><i class="bi bi-x"></i></button>
                        </div>
                    </div>
                </div>
                <div class="card custom-card mt-4">
                    <div class="card-body">
                        <div class="contact-header">
                            <div class="d-sm-flex d-block align-items-center justify-content-between">
                                <div class="h5 fw-semibold mb-0">Filterby</div>
                                <div class="d-flex mt-sm-0 mt-2 align-items-center">
                                    <form action="{% url 'list_company' %}" method="get" class="row">
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <select name="location" class="form-control form-select">
                                                    <option value="">Location</option>
                                                    {% for location, count in location_counts.items %}
                                                    <option value="{{ location }}">{{ location }} ({{ count }})
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group">
                                                <select name="company_size" class="form-control form-select">
                                                    <option value="">Company size</option>
                                                    {% for company_size, count in company_size_counts.items %}
                                                    <option value="{{ company_size }}">{{ company_size }} ({{ count }})
                                                    </option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group d-flex gap-3">
                                                <select name="employment_type" class="form-control form-select">
                                                    <option value="">Jobs for</option>
                                                    {% for employment_type, count in employment_type_counts.items %}
                                                    <option value="{{ employment_type }}">{{ employment_type }} ({{ count }})</option>
                                                    {% endfor %}
                                                </select>
                                                <button type="submit" class="btn btn-primary"><i
                                                        class="ri-search-line"></i></button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-xl-12 col-lg-12">
                        <div class="row mt-4">
                            {% if companies %}
                            {% for company in companies %}
                            <div class="col-xl-4">
                                <div class="card custom-card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <div class="card-title">{{ company.company_name }}</div>
                                        <div class="text-end">
                                            <!-- Add edit link -->
                                            <a href="{% url 'edit_company' company.company_id %}"
                                                class="btn btn-sm btn-primary-light btn-wave waves-effect waves-light"
                                                data-toggle="tooltip" data-placement="top" title="Edit">
                                                <i class="ti ti-edit"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex align-items-center justify-content-between gap-2">
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="lh-1">
                                                    <span class="avatar avatar-rounded">
                                                        <img src="../../media/{{ company.company_image }}" alt="">
                                                    </span>
                                                </div>
                                                <div>
                                                    <span class="d-block text-dark fs-12 fw-normal"><i
                                                            class="bi bi-envelope-check"></i> {{ company.company_contact_email }}</span>
                                                    <span class="d-block text-muted fs-12 fw-normal"><i
                                                            class="bi bi-geo-alt fs-11"></i> {{ company.company_location }}</span>
                                                    <span class="badge bg-dark-transparent text-end"> Employees - {{ company.company_size }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <div class="justify-content-end d-flex gap-3">
                                            <button
                                                class="btn btn-sm btn-secondary-light btn-wave waves-effect waves-light"
                                                data-toggle="tooltip" data-placement="top" title="Preview">
                                                <a href="{% url 'preview_company' company.company_id %}"><i
                                                        class="ti ti-eye"></i></a>
                                            </button>

                                            <button
                                                class="btn btn-sm btn-warning-light btn-wave waves-effect waves-light"
                                                data-toggle="tooltip" data-placement="top" title="Post Job">
                                                <a href="{% url 'add_jobs' %}"><i class="ti ti-send"></i></a>
                                            </button>

                                            <!-- Delete button -->
                                            <button
                                                class="btn btn-sm btn-danger-light btn-wave waves-effect waves-light delete-company-btn"
                                                data-toggle="tooltip" data-placement="top" title="Delete"
                                                data-bs-toggle="modal" data-bs-target="#deleteModal"
                                                data-company-id="{{ company.company_id }}">
                                                <i class="ti ti-trash"></i>
                                            </button>
                                            {% for company_count in job_counts_by_company %}
                                            {% if company_count.company_id == company.company_id %}
                                            <span class="badge bg-danger-transparent">{{ company_count.job_count }} Jobs
                                                Posted</span>
                                            {% endif %}
                                            {% empty %}
                                            <span class="badge bg-danger-transparent">No Jobs Posted</span>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                            {% else %}
                            <div class="col-xl-12">
                                <p>No companies found.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    </div> <!--End::row-1 -->
    </div>
    </div> <!-- End::app-content -->
    <!-- Footer Start -->
    <footer class="footer mt-auto py-3 bg-white text-center">
        <div class="container"> <span class="text-muted"> Copyright © <span id="year">2024</span>. Designed
                with
                <span class="bi bi-heart-fill text-danger"></span> by <a href="javascript:void(0);"> <span
                        class="fw-semibold text-primary text-decoration-underline">Touchmark
                        Descience</span>
                </a>
                All
                rights
                reserved </span>
        </div>
    </footer> <!-- Footer End -->
    </div>
    <script src="{% static 'static/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // Function to handle soft delete when the "Delete" button is clicked
        document.querySelectorAll('.delete-company-btn').forEach(button => {
            button.addEventListener('click', function () {
                const companyId = this.getAttribute('data-company-id');
                document.getElementById('confirmDelete').setAttribute('data-company-id', companyId);
            });
        });

        // Function to handle soft delete when the "Delete" button in the modal is clicked
        document.getElementById('confirmDelete').addEventListener('click', function () {
            const companyId = this.getAttribute('data-company-id');
            if (companyId !== null && companyId !== undefined) {
                fetch(`/delete_company/${companyId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken() // Make sure to define this function to get CSRF token
                    }
                })
                    .then(response => {
                        if (response.ok) {
                            console.log('Company soft-deleted successfully');
                            window.location.reload();
                        } else {
                            console.error('Error soft-deleting company');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            } else {
                console.error('Company ID is null or undefined');
            }
        });

        // Function to get CSRF token
        function getCSRFToken() {
            const csrfCookie = document.cookie.split(';').find(cookie => cookie.trim().startsWith('csrftoken='));
            if (csrfCookie) {
                return csrfCookie.split('=')[1];
            }
            return null;
        }
    </script>

    <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <!-- FLATPICKR JS -->
    <script src="{% static 'js/date-picker.min.js' %}"></script>
    <script src="{% static 'libs/flatpickr/flatpickr.min.js' %}"></script>
    <script src="{% static 'js/defaultmenu.min.js' %}"></script>
    <script src="{% static 'libs/node-waves/waves.min.js' %}"></script>
    <script src="{% static 'js/nouislider.min.js' %}"></script>
    <script src="{% static 'js/job-search-candidate.js' %}"></script>
    <script src="{% static 'js/jobs-post.js' %}"></script>
    <script src="{% static 'js/wNumb.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static 'js/choice.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/validation.js' %}"></script>
    <script src="{% static 'js/custom-switcher.min.js' %}"></script>
    <script src="{% static 'js/nouislider.js' %}"></script>
    <script src=".{% static 'libs/choices.js/public/static/scripts/choices.min.js' %}"></script>
    <!-- jQuery CDN CHOICES JS-->
    <script src="{% static 'libs/choices.js/public/assets/scripts/choices.min.js' %}"></script>
</body>

</html>